<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Martin Chan" />

<meta name="date" content="2019-05-18" />

<title>Vignette: Dealing with SPSS labels in R</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>



<link rel="stylesheet" href="SPSS_Labels_in_R_18-05-19_files/style.css" type="text/css" />

</head>

<body>




<section class="page-header">
<h1 class="title toc-ignore project-name">Vignette: Dealing with SPSS labels in R</h1>
<h4 class="author project-author">Martin Chan</h4>
<h4 class="date project-date">May 18, 2019</h4>
</section>



<section class="main-content">
<div id="background" class="section level2">
<h2>Background</h2>
<p>As survey data is pretty much unavoidable in my work, I’m always on the look out for new and better ways to improve my survey analysis workflow in R. Funnily enough, when I was first starting out to use R I didn’t think R was at all intuitive or easy to work with survey data. Rather painful, if I’m completely honest!</p>
<p>One of the big reasons was labels. Most survey data cannot be analysed independently of the <strong>variable</strong> (e.g. <em>Q1. What is your gender?</em>) and <strong>value labels</strong> (e.g. 1 = <strong>Male</strong>, 2 = <strong>Female</strong>, 3 = <strong>Other</strong>, …) - which is true in the case of <strong>categorical variables</strong>, but even for ordinal Likert scale variables like “On a scale of 1 to 10, how much do you agree with…”, the meaning of the value is especially contingent on the nuanced wording of the agree-disagree statement; respondents with a different classification within the survey (e.g. “working professional” vs “retirees”) may get a statement that is worded slightly differently.</p>
<p>The base <strong>data frame</strong> in R does not easily lend itself to work easily with these labels. A lot of merging, sorting, recoding etc. therefore is then necessary in order to turn the analysis into neat output contingency tables that you typically get via other specialised survey analysis software, like SPSS or <a href="https://www.qresearchsoftware.com/">Q</a>, for example:</p>
<pre><code>## # A tibble: 3 x 3
##   `Q10 Top 2 Box Agree`                 `R Users Segmen~ `Python Users Seg~
##   &lt;chr&gt;                                 &lt;chr&gt;            &lt;chr&gt;             
## 1 Coding R is one of my hobbies         88.1%            60.0%             
## 2 I don&#39;t like to spend time in front ~ 40.5%            39.1%             
## 3 I would be inclined to quit my job i~ 70.1%            40.5%</code></pre>
<p>Of course, another big reason was my own ignorance at the time of all the different methods and packages available out there, which would otherwise make a lot of this easier.</p>
<p>This post provides a tour of the various functions (from different packages) that I wish I had known at the time. Despite the title, it’s not just about <strong>SPSS</strong>: there are plenty of other formats (e.g. SAS files) out there which carry variable and value labels, but I think this title is justified because:</p>
<ol style="list-style-type: decimal">
<li>Most people starting out on survey data analysis will tend to first come across SPSS files (.sav)</li>
<li>It’s still one of the most popular data formats for survey data</li>
<li>It’s a SPSS file that I will use as a demo in this post (perhaps not a compelling reason, but still a reason)</li>
</ol>
</div>
<div id="lets-start" class="section level2">
<h2>Let’s start!</h2>
<p>Let us first load in all the packages that we’ll use in this post. For clarity, I will still make the package-source of the functions explicit (e.g. <code>labelled::val_label()</code>) so it’s easy to see where each function comes from. One of these packages <strong>surveytoolbox</strong> is my own and available on Github only, and if you’re interested you can install this by running <code>devtools::install_github("martinctc/surveytoolbox")</code>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">library</span>(haven)</a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">library</span>(sjlabelled)</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="kw">library</span>(labelled) </a>
<a class="sourceLine" id="cb2-5" title="5"><span class="kw">library</span>(surveytoolbox) <span class="co"># install with devtools::install_github(&quot;martinctc/surveytoolbox&quot;)</span></a></code></pre></div>
<p>Since all I really needed is just an open-source, simple, and accessible SPSS / .sav dataset with variable and value labels that I could use for examples, I simply went online and found the first thing that matched these criteria. Not the most exciting - it’s the <strong>1991 General Social Survey</strong>, which is a nationally representative sample of adults in the United States. You can download the SAV file from the ARDA site <a href="http://www.thearda.com/Archive/Files/Downloads/GSS1991_DL2.asp">here</a>.</p>
<p><code>haven::read_sav()</code> is my favourite way of loading in SPSS files. In my experience, it rarely has any problems and is generally fast enough; it is also part of the <a href="https://haven.tidyverse.org/">tidyverse</a>. There are other alternatives such as <code>sjlabelled::read_spss()</code> and <code>foreign::read.spss()</code>, but <strong>haven</strong> is my recommendation - you can pick a favourite and have these available in your backpocket.<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> Note that <code>foreign::read.spss()</code> returns a list rather than a data frame or a tibble, which is less ideal.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">file_path &lt;-<span class="st"> &quot;../datasets/General Social Survey_1991.SAV&quot;</span></a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3">source_data_hv &lt;-<span class="st"> </span>haven<span class="op">::</span><span class="kw">read_sav</span>(file_path)</a>
<a class="sourceLine" id="cb3-4" title="4">source_data_sj &lt;-<span class="st"> </span>sjlabelled<span class="op">::</span><span class="kw">read_spss</span>(file_path)</a>
<a class="sourceLine" id="cb3-5" title="5">source_data_fo &lt;-<span class="st"> </span>foreign<span class="op">::</span><span class="kw">read.spss</span>(file_path)</a></code></pre></div>
<p>Running <code>glimpse()</code> on the first twenty rows show that many variables are of the <strong>labelled double</strong> class - meaning that these variables would have labels associated with the numeric values they hold. The numbers alone us tell us nothing about what they represent, as these are likely to be categorical variables “in reality”.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">source_data_hv <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># File read in using `haven::read_sav()`</span></a>
<a class="sourceLine" id="cb4-2" title="2"><span class="st">  </span>.[,<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>] <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># First 20 columns</span></a>
<a class="sourceLine" id="cb4-3" title="3"><span class="st">  </span><span class="kw">glimpse</span>() </a></code></pre></div>
<p>Note that <code>haven::read_sav()</code> reads these labelled variables in as a class called <code>haven_labelled</code>, whilst <code>sjlabelled::read_spss()</code> would read these in as numeric variables cotaining label attributes:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">source_data_hv<span class="op">$</span>MARITAL <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a></code></pre></div>
<pre><code>## [1] &quot;haven_labelled&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1">source_data_sj<span class="op">$</span>MARITAL <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">class</span>()</a></code></pre></div>
<pre><code>## [1] &quot;numeric&quot;</code></pre>
<p>Running <code>attr()</code> shows that both methods of reading the SPSS file will return variables with labels attributes:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">source_data_hv<span class="op">$</span>MARITAL <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">attr</span>(<span class="st">&#39;labels&#39;</span>)</a></code></pre></div>
<pre><code>##       Married       Widowed      Divorced     Separated Never married 
##             1             2             3             4             5</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">source_data_sj<span class="op">$</span>MARITAL <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">attr</span>(<span class="st">&#39;labels&#39;</span>)</a></code></pre></div>
<pre><code>##       Married       Widowed      Divorced     Separated Never married 
##             1             2             3             4             5</code></pre>
</div>
<div id="exploring-the-dataset" class="section level2">
<h2>Exploring the dataset</h2>
<p>Before you perform any analysis it’s necessary to first explore the data, which is slightly tric</p>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>See <a href="https://www.r-bloggers.com/working-with-spss-data-in-r/">this</a> blog post for a more in-depth discusssion on the differences<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
</section>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
